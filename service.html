<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฎุฏูุงุชูุง</title>
    <link rel="stylesheet" href="./styles/service.css">

</head>
<body>
    <div class="container">
        <h1>ุฎุฏูุงุชูุง</h1>
        
        <form id="serviceForm" class="service-form" method="post" action="service.php" enctype="multipart/form-data">
            <div class="form-group">
                <label>ุงุฎุชุฑ ููุน ุงูุฎุฏูุฉ:</label>
                <div class="service-types">
                    <div class="service-type" data-service="statistics">
                        <i class="icon">๐</i>
                        <h3>ุฅุญุตุงุก ุชุญูููู</h3>
                        <p>ุชุญููู ุจูุงูุงุช ูุงุณุชุฎุฑุงุฌ ูุชุงุฆุฌ ุฅุญุตุงุฆูุฉ</p>
                    </div>
                    <div class="service-type" data-service="translation">
                        <i class="icon">๐</i>
                        <h3>ุฎุฏูุฉ ุงูุชุฑุฌูุฉ</h3>
                        <p>ุชุฑุฌูุฉ ูุตูุต ููุณุชูุฏุงุช</p>
                    </div>
                    <div class="service-type" data-service="proofreading">
                        <i class="icon">โ๏ธ</i>
                        <h3>ุชุฏููู ูุบูู</h3>
                        <p>ุชุตุญูุญ ุงูุฃุฎุทุงุก ุงููุบููุฉ ูุงูุฅููุงุฆูุฉ</p>
                    </div>
                    <div class="service-type" data-service="inquiry">
                        <i class="icon">โ</i>
                        <h3>ุงุณุชูุณุงุฑ</h3>
                        <p>ุงุณุชูุณุงุฑ ุนู ุงูุฎุฏูุงุช ุงููุชุงุญุฉ</p>
                    </div>
                    <div class="service-type" data-service="booking">
                        <i class="icon">๐</i>
                        <h3>ุญุฌุฒ ูุจุงุดุฑ</h3>
                        <p>ุญุฌุฒ ููุนุฏ ูุจุงุดุฑ ูุฎุฏูุงุชูุง</p>
                    </div>
                    <div class="service-type" data-service="other">
                        <i class="icon">โ</i>
                        <h3>ุฎุฏูุงุช ุฃุฎุฑู</h3>
                        <p>ุฎุฏูุงุช ูุชููุนุฉ ุฃุฎุฑู</p>
                    </div>
                </div>
                <input type="hidden" id="selectedService" name="service_type" required>
                <div class="error-message" id="serviceError"></div>
            </div>
            
            <div class="form-group other-service-box" id="otherServiceBox">
                <label for="otherServiceInput">ูุง ูู ุงูุฎุฏูุฉ ุงููุทููุจุฉุ</label>
                <input type="text" id="otherServiceInput" name="other_service" placeholder="ูุฑุฌู ุชุญุฏูุฏ ุงูุฎุฏูุฉ ุงููุทููุจุฉ">
            </div>
            
            <div class="form-group inquiry-box" id="inquiryBox">
                <label for="inquiryText">ุงุณุชูุณุงุฑู:</label>
                <textarea id="inquiryText" name="inquiry_text" rows="5" placeholder="ุงูุชุจ ุงุณุชูุณุงุฑู ููุง..."></textarea>
            </div>
            
            <div class="form-group" id="fileUploadBox">
                <label>ุงููููุงุช ุงููุทููุจุฉ:</label>
                <div class="file-upload" id="dropZone">
                    <p>ุงุณุญุจ ุงููููุงุช ููุง ุฃู ุงุถุบุท ูุงุฎุชูุงุฑ ุงููููุงุช</p>
                    <div class="file-upload-btn" id="fileUploadBtn">ุงุฎุชูุงุฑ ูููุงุช</div>
                    <input type="file" id="fileInput" name="files[]" multiple>
                </div>
                <div class="file-list" id="fileList"></div>
                <div class="error-message" id="fileError"></div>
            </div>
            
            <div class="form-group">
                <label for="notes">ููุงุญุธุงุช ุฅุถุงููุฉ:</label>
                <textarea id="notes" name="notes" rows="4" placeholder="ุฃุถู ุฃู ููุงุญุธุงุช ุชุชุนูู ุจุงูุฎุฏูุฉ ุงููุทููุจุฉ..."></textarea>
            </div>
            
            <button type="submit" class="btn-submit">ุชูุฏูู ุงูุทูุจ</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const serviceTypes = document.querySelectorAll('.service-type');
            const selectedServiceInput = document.getElementById('selectedService');
            const otherServiceBox = document.getElementById('otherServiceBox');
            const inquiryBox = document.getElementById('inquiryBox');
            const fileUploadBox = document.getElementById('fileUploadBox');
            const fileInput = document.getElementById('fileInput');
            const fileUploadBtn = document.getElementById('fileUploadBtn');
            const dropZone = document.getElementById('dropZone');
            const fileList = document.getElementById('fileList');
            const serviceForm = document.getElementById('serviceForm');
            const serviceError = document.getElementById('serviceError');
            const fileError = document.getElementById('fileError');
            
            // Selected files array
            let selectedFiles = [];
            
            // Service type selection
            serviceTypes.forEach(function(serviceType) {
                serviceType.addEventListener('click', function() {
                    // Remove selected class from all service types
                    serviceTypes.forEach(function(type) {
                        type.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked service type
                    this.classList.add('selected');
                    
                    // Update the hidden input value
                    const serviceValue = this.getAttribute('data-service');
                    selectedServiceInput.value = serviceValue;
                    
                    // Show/hide specific elements based on service type
                    if (serviceValue === 'inquiry') {
                        inquiryBox.style.display = 'block';
                        fileUploadBox.style.display = 'none';
                    } else if (serviceValue === 'other') {
                        otherServiceBox.style.display = 'block';
                        inquiryBox.style.display = 'none';
                        fileUploadBox.style.display = 'block';
                    } else {
                        otherServiceBox.style.display = 'none';
                        inquiryBox.style.display = 'none';
                        fileUploadBox.style.display = 'block';
                    }
                    
                    // Clear error message
                    serviceError.textContent = '';
                });
            });
            
            // File upload button click
            fileUploadBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            // File selection
            fileInput.addEventListener('change', function() {
                handleFiles(this.files);
            });
            
            // Drag and Drop functionality
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropZone.style.borderColor = '#3498db';
                dropZone.style.backgroundColor = '#e1f0fa';
            }
            
            function unhighlight() {
                dropZone.style.borderColor = '#ddd';
                dropZone.style.backgroundColor = '#f9f9f9';
            }
            
            dropZone.addEventListener('drop', function(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }, false);
            
            // Handle files function
            function handleFiles(files) {
                if (files.length > 0) {
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        
                        // Check if file is already in the list
                        if (!isFileAlreadyAdded(file)) {
                            selectedFiles.push(file);
                            addFileToList(file);
                        }
                    }
                    
                    // Clear error message
                    fileError.textContent = '';
                }
            }
            
            // Check if file is already added
            function isFileAlreadyAdded(file) {
                return selectedFiles.some(existingFile => 
                    existingFile.name === file.name && 
                    existingFile.size === file.size && 
                    existingFile.type === file.type
                );
            }
            
            // Add file to list
            function addFileToList(file) {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                const fileName = document.createElement('div');
                fileName.className = 'file-name';
                
                // File icon based on type
                let fileIcon = '๐';
                if (file.type.includes('image')) {
                    fileIcon = '๐ผ๏ธ';
                } else if (file.type.includes('pdf')) {
                    fileIcon = '๐';
                } else if (file.type.includes('word')) {
                    fileIcon = '๐';
                } else if (file.type.includes('excel') || file.type.includes('spreadsheet')) {
                    fileIcon = '๐';
                }
                
                fileName.innerHTML = `<span>${fileIcon}</span> ${file.name} <span class="file-type">(${formatFileSize(file.size)})</span>`;
                
                const removeBtn = document.createElement('span');
                removeBtn.className = 'remove-file';
                removeBtn.textContent = 'โ';
                removeBtn.addEventListener('click', function() {
                    // Remove file from array
                    const fileIndex = selectedFiles.indexOf(file);
                    if (fileIndex > -1) {
                        selectedFiles.splice(fileIndex, 1);
                    }
                    
                    // Remove file item from list
                    fileList.removeChild(fileItem);
                });
                
                fileItem.appendChild(fileName);
                fileItem.appendChild(removeBtn);
                fileList.appendChild(fileItem);
            }
            
            // Format file size
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            // Form submission
            serviceForm.addEventListener('submit', function(e) {
                e.preventDefault();
                let isValid = true;
                
                // Validate service type
                if (!selectedServiceInput.value) {
                    serviceError.textContent = 'ูุฑุฌู ุงุฎุชูุงุฑ ููุน ุงูุฎุฏูุฉ';
                    isValid = false;
                }
                
                // Validate files for non-inquiry services
                if (selectedServiceInput.value !== 'inquiry' && selectedFiles.length === 0) {
                    fileError.textContent = 'ูุฑุฌู ุฑูุน ููู ูุงุญุฏ ุนูู ุงูุฃูู';
                    isValid = false;
                }
                
                if (isValid) {
                    // Create FormData object
                    const formData = new FormData(this);
                    
                    // Append selected files
                    selectedFiles.forEach(function(file, index) {
                        formData.append('files[]', file);
                    });
                    
                    // Submit form using AJAX
                    fetch('service.php', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('ุชู ุชูุฏูู ุทูุจู ุจูุฌุงุญ! ุฑูู ุงูุทูุจ: ' + data.request_id);
                            // Reset form
                            serviceForm.reset();
                            selectedFiles = [];
                            fileList.innerHTML = '';
                            serviceTypes.forEach(function(type) {
                                type.classList.remove('selected');
                            });
                            otherServiceBox.style.display = 'none';
                            inquiryBox.style.display = 'none';
                        } else {
                            alert('ุญุฏุซ ุฎุทุฃ: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชูุฏูู ุงูุทูุจ');
                    });
                }
            });
        });
    </script>
</body>
</html>