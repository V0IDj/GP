<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ‚Ø¯ÙŠÙ… Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯</title>
    <link rel="stylesheet" href="./styles/researchsubmit.css">

</head>
<body>
    <div class="container">
        <h1>ØªÙ‚Ø¯ÙŠÙ… Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯</h1>
        
        <div id="success-alert" class="alert alert-success">
            ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¨Ø­Ø« Ø¨Ù†Ø¬Ø§Ø­!
        </div>
        
        <div id="error-alert" class="alert alert-danger">
            Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¨Ø­Ø«. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
        </div>
        
        <form id="research-form" enctype="multipart/form-data">
            <div class="form-group">
                <label for="title" class="required">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«</label>
                <input type="text" id="title" name="title" required>
            </div>
            
            <div class="form-group">
                <label class="required">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q1" name="classification" value="Q1" required>
                        <label for="q1">Q1</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q2" name="classification" value="Q2">
                        <label for="q2">Q2</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q3" name="classification" value="Q3">
                        <label for="q3">Q3</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q4" name="classification" value="Q4">
                        <label for="q4">Q4</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="required">Ù…ÙƒØ§Ù† Ø§Ù„Ù†Ø´Ø±</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="journal" name="where_to_publish" value="Journal" required>
                        <label for="journal">Ù…Ø¬Ù„Ø© Ø¹Ù„Ù…ÙŠØ©</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="book" name="where_to_publish" value="Book Chapter">
                        <label for="book">ÙØµÙ„ ÙƒØªØ§Ø¨</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="conference" name="where_to_publish" value="Conference">
                        <label for="conference">Ù…Ø¤ØªÙ…Ø±</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="required"> Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø­Ø«</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="practical" name="r_type" value="practical" required>       
                                        
                         <label for="practical">Ø¹Ù…Ù„ÙŠ</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="theoretical" name="r_type" value="theoretical" required>
                        <label for="theoretical">Ù†Ø¸Ø±ÙŠ</label>
                    </div>
                    
                </div>
            </div>
            
            <div class="form-group">
                <label for="college">Ø§Ù„ÙƒÙ„ÙŠØ©</label>
                <input type="text" id="college" name="college">
            </div>
            
            <div class="form-group">
                <label for="user_notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¨Ø§Ø­Ø«</label>
                <textarea id="user_notes" name="user_notes"></textarea>
            </div>
            
            <div class="form-group">
                <label for="research_files" class="required">Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨Ø­Ø«</label>
                <div class="file-upload-container" id="file-upload-container">
                    <input type="file" id="research_files" name="research_files" class="file-upload-input" required>
                    <div class="file-upload-icon">ğŸ“„</div>
                    <div class="file-upload-text">Ø§Ù†Ù‚Ø± Ù‡Ù†Ø§ Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ø¨Ø­Ø«</div>
                    <div class="file-upload-subtext">Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù ÙˆØ£ÙÙ„ØªÙ‡ Ù‡Ù†Ø§</div>
                </div>
                <div class="file-selected" id="file-selected">
                    <span class="file-icon">ğŸ“</span>
                    <span id="file-name"></span>
                </div>
            </div>
            
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">Ø¬Ø§Ø±ÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¨Ø­Ø«...</div>
            </div>
            
            <button type="submit" id="submit-btn">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¨Ø­Ø«</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('research-form');
            const successAlert = document.getElementById('success-alert');
            const errorAlert = document.getElementById('error-alert');
            const loading = document.getElementById('loading');
            const fileInput = document.getElementById('research_files');
            const fileSelected = document.getElementById('file-selected');
            const fileName = document.getElementById('file-name');
            const fileContainer = document.getElementById('file-upload-container');

            // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø±Ù‡
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    fileName.textContent = this.files[0].name;
                    fileSelected.style.display = 'block';
                    fileContainer.style.borderColor = '#2ecc71';
                } else {
                    fileSelected.style.display = 'none';
                    fileContainer.style.borderColor = '#3498db';
                }
            });

            // Ø¥Ø¶Ø§ÙØ© Ø®Ø§ØµÙŠØ© Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª Ù„Ù„Ù…Ù„ÙØ§Øª
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                fileContainer.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                fileContainer.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                fileContainer.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                fileContainer.style.borderColor = '#2ecc71';
                fileContainer.style.backgroundColor = '#eeffee';
            }

            function unhighlight() {
                fileContainer.style.borderColor = '#3498db';
                fileContainer.style.backgroundColor = '#f9f9f9';
            }

            fileContainer.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                fileInput.files = files;
                if (files.length > 0) {
                    fileName.textContent = files[0].name;
                    fileSelected.style.display = 'block';
                }
            }

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                successAlert.style.display = 'none';
                errorAlert.style.display = 'none';
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                if (!validateForm()) {
                    return;
                }
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
                loading.style.display = 'block';
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                const formData = new FormData(form);
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
                fetch('researchsubmit.php', {
                    method: 'POST',
                    body: formData,
                    // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø±Ø¤ÙˆØ³ Ø®Ø§ØµØ© Ù„Ù„Ø·Ù„Ø¨ Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ CORS
                    headers: {
                        // Ù„Ø§ Ù†Ø¶ÙŠÙ Ø±Ø¤ÙˆØ³ Content-Type Ø¹Ù†Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… FormData
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Server returned ' + response.status + ' ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    loading.style.display = 'none';
                    
                    if (data.success) {
                        successAlert.textContent = data.message || 'ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¨Ø­Ø« Ø¨Ù†Ø¬Ø§Ø­!';
                        successAlert.style.display = 'block';
                        form.reset();
                        fileSelected.style.display = 'none';
                        fileContainer.style.borderColor = '#3498db';
                        window.scrollTo(0, 0);
                    } else {
                        errorAlert.textContent = data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¨Ø­Ø«. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                        errorAlert.style.display = 'block';
                        window.scrollTo(0, 0);
                    }
                })
                .catch(error => {
                    loading.style.display = 'none';
                    console.error('Error:', error);
                    errorAlert.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ' + error.message;
                    errorAlert.style.display = 'block';
                    window.scrollTo(0, 0);
                });
            });
            
            function validateForm() {
                const title = document.getElementById('title').value.trim();
                const classification = document.querySelector('input[name="classification"]:checked');
                const whereToPublish = document.querySelector('input[name="where_to_publish"]:checked');
                const researchFiles = document.getElementById('research_files').files;
                
                let isValid = true;
                let errorMessage = '';
                
                if (!title) {
                    errorMessage = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«';
                    isValid = false;
                } else if (!classification) {
                    errorMessage = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨Ø­Ø«';
                    isValid = false;
                } else if (!whereToPublish) {
                    errorMessage = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙƒØ§Ù† Ø§Ù„Ù†Ø´Ø±';
                    isValid = false;
                } else if (researchFiles.length === 0) {
                    errorMessage = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨Ø­Ø«';
                    isValid = false;
                }
                
                if (!isValid) {
                    errorAlert.textContent = errorMessage;
                    errorAlert.style.display = 'block';
                    window.scrollTo(0, 0);
                }
                
                return isValid;
            }
        });
    </script>
</body>
</html>